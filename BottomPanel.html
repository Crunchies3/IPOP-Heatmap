<span class="close-btn" onclick="closeBottomPanel()"><i class="fa fa-times" aria-hidden="true"></i></span>
<h2>IPOP Heatmap Dashboard</h2>
<br>
<h7>Note: You can hover to the colored segments to see the details.</h7>
<hr style="color:#2A52A4;">

<!-- Chart -->

<div class="container-fluid">

  <div class="row">

    <div class="col-md-6">
      <div id="chart1" class="chart"></div>

      <div id="chart_div"></div>
    </div>



    <div class="col-md-6">
      <div id="piechart" style="width: 620px; height: 350px;"></div>
    </div>

  </div>

  <br>
  <hr style="color:#2A52A4;">

  <div class="row">

    <div class="col-md-14">
      <div id="chart2" class="chart"></div>
    </div>

  </div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/canvasjs/1.7.0/canvasjs.min.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script>

  google.charts.load("current", { packages: ['corechart'] });

  // Call the getDataForGraphCS() function and pass the returned values to csChart()
  google.charts.setOnLoadCallback(function () {
    google.script.run.withSuccessHandler(csChart).getDataForGraphCS();
  });

  google.charts.setOnLoadCallback(function () {
    google.script.run.withSuccessHandler(rcChart).getDataForGraphRC();
  });

  // Define csChart function to create the chart
  function csChart(flattenedValues) {
    // Assuming you have 5 rows and 4 columns (B2:E6 range)
    var numRows = 5; // Number of rows
    var numColumns = 4; // Number of columns

    // Extract values from the flattened array and populate data array for the chart
    var data = google.visualization.arrayToDataTable([
      ['Category', 'Terrestrial/Dry Segment', 'Wet Segment', 'Undetermined', 'Backhaul'],
      ['C2C'].concat(flattenedValues.slice(0, numColumns)), // Slice the array to get values for the first row
      ['EAC'].concat(flattenedValues.slice(numColumns, 2 * numColumns)), // Values for the second row
      ['SEA-US'].concat(flattenedValues.slice(2 * numColumns, 3 * numColumns)), // Values for the third row
      ['TGN-IA/TGN-P'].concat(flattenedValues.slice(3 * numColumns, 4 * numColumns)) // Values for the fourth row
    ]);

    var options = {
      title: 'Total Reported Segments Based on Cable Sytem',
      bar: {
        groupWidth: '80%'
      },
      height: '320',
      legend: 'none',
      width: '550',
      chartArea: {
        width: '90%', // Adjust the width of the chart area to fit  within the container
        height: '80%' // Adjust the height of the chart area to fit within the container
      },
      hAxis: {
        textStyle: {
          fontSize: 12, // Adjust font size as needed
          bold: true // Make the text bold
        },
        slantedText: false, // Disable slanted text
      },
      legend: {
        position: 'bottom', // Position the legend at the top
        align: 'center', // Center align the legend
        maxLines: 1, // Limit the number of lines in the legend
        textStyle: { // Add padding to the legend
          fontSize: 12
        },
      }
    };

    var chart = new google.visualization.ColumnChart(document.getElementById('chart1'));

    if (navigator.userAgent.match(/Trident\/7\./)) {
      google.visualization.events.addListener(chart, 'click', function () {
        chart_div.innerHTML = '<img src="' + chart.getImageURI() + '">';
        console.log(chart_div.innerHTML);
      });
      chart.draw(data, options);
    } else {
      google.visualization.events.addListener(chart, 'select png', function () {
        chart_div.innerHTML = '<img src="' + chart.getImageURI() + '">';
        console.log(chart_div.innerHTML);
      });
      chart.draw(data, options);
      document.getElementById('png').innerHTML = '<a href="' + chart.getImageURI() + '" target="_blank"><span class="glyphicon glyphicon-print"></span></a>';
    }
  }


  function rcChart(flattenedValues) {
    // Assuming you have 9 rows and 4 columns (B10:E18 range)
    var numRows = 9; // Number of rows
    var numColumns = 4; // Number of columns

    // Extract values from the flattened array and populate data array for the chart
    var data = google.visualization.arrayToDataTable([
      ['Category', 'Terrestrial/Dry Segment', 'Wet Segment', 'Undetermined', 'Backhaul'],
      ['BMH Issue'].concat(flattenedValues.slice(0, numColumns)), // Values for BMH Issue
      ['Cable Fault'].concat(flattenedValues.slice(numColumns, 2 * numColumns)), // Values for Cable Fault
      ['Card Failure'].concat(flattenedValues.slice(2 * numColumns, 3 * numColumns)), // Values for Card Failure
      ['Configuration Issue'].concat(flattenedValues.slice(3 * numColumns, 4 * numColumns)), // Values for Configuration Issue
      ['Force Majeure'].concat(flattenedValues.slice(4 * numColumns, 5 * numColumns)), // Values for Force Majeure
      ['Planned Maintenance'].concat(flattenedValues.slice(5 * numColumns, 6 * numColumns)), // Values for Planned Maintenance
      ['Shunt Fault'].concat(flattenedValues.slice(6 * numColumns, 7 * numColumns)), // Values for Shunt Fault
      ['Subsea Equipment Fault'].concat(flattenedValues.slice(7 * numColumns, 8 * numColumns)), // Values for Subsea Equipment Fault
      ['Unknown'].concat(flattenedValues.slice(8 * numColumns, 9 * numColumns)) // Values for Unknown
    ]);

    var options = {
      title: 'Total Reported Segments Based on Root Cause (High Level)',
      bar: {
        groupWidth: '80%'
      },
      height: '300',
      legend: 'none',
      width: '1300',
      chartArea: {
        width: '90%', // Adjust the width of the chart area to fit  within the container
        height: '80%' // Adjust the height of the chart area to fit within the container
      },
      hAxis: {
        textStyle: {
          fontSize: 12, // Adjust font size as needed
          bold: true // Make the text bold
        },
        slantedText: false, // Disable slanted text
      },
      legend: {
        position: 'bottom', // Position the legend at the top
        alignment: 'center', // Center align the legend
        maxLines: 1, // Limit the number of lines in the legend
        textStyle: { // Add padding to the legend
          fontSize: 12,
          padding: 50, // Adjust the padding as needed
        }
      }
    };

    var chart = new google.visualization.ColumnChart(document.getElementById('chart2'));

    if (navigator.userAgent.match(/Trident\/7\./)) {
      google.visualization.events.addListener(chart, 'click', function () {
        chart_div.innerHTML = '<img src="' + chart.getImageURI() + '">';
        console.log(chart_div.innerHTML);
      });
      chart.draw(data, options);
    } else {
      google.visualization.events.addListener(chart, 'select png', function () {
        chart_div.innerHTML = '<img src="' + chart.getImageURI() + '">';
        console.log(chart_div.innerHTML);
      });
      chart.draw(data, options);
      document.getElementById('png').innerHTML = '<a href="' + chart.getImageURI() + '" target="_blank"><span class="glyphicon glyphicon-print"></span></a>';
    }
  }

  google.charts.setOnLoadCallback(drawChart);

  function drawChart() {
    // Call the getDataForPieChart function from the server-side script
    google.script.run.withSuccessHandler(function (totalValues) {
      // Create the data table
      var data = new google.visualization.DataTable();
      data.addColumn('string', 'Category');
      data.addColumn('number', 'Count');
      data.addRows([['Notifications', totalValues[0]], ['Start Date', totalValues[1]], ['End Date', totalValues[2]]]);

      // Set chart options
      var options = {
        title: 'Total Records per Category',
        pieHole: 0.4, // Makes a donut chart
        fontSize: 16,
        colors: ['#1f77b4', '#ff7f0e', '#ffbb78'], // Set custom colors
      };

      // Instantiate and draw the chart
      var chart = new google.visualization.PieChart(document.getElementById('piechart'));
      chart.draw(data, options);
    }).getDataForPieChart(); // Call the server-side function
  }

</script>

<style>
  .container-fluid {
    margin-right: -40px;
    margin-left: -10px;
  }

  .chart {
    align-content: center;
    display: flex;
    justify-content: center;
    margin-top: 20px;
  }
</style>